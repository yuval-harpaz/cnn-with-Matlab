
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>visiontools_importKeras2</title><meta name="generator" content="Bluefish 2.2.7" ><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-02-04"><meta name="DC.source" content="visiontools_importKeras2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:16px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }


  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Compete with keras over vgg16 visualisation</a></li>
  <li><a href="#2">Load VGG16</a></li><li><a href="#3">Visualise increasingly complexed layers</a></li><li><a href="#4">Visualize class nodes</a>
  </li><li><a href="#5">So what have we learned?</a></li></ul></div><h2 id="1">Compete with keras over vgg16 visualisation</h2>
  <p>Here I am following this <a href="https://blog.keras.io/how-convolutional-neural-networks-see-the-world.html">blog</a> which explains how CNN sees the world. blog which offers visualisation procedures for Keras. While I am greatful for it to show me the way, I am trying to see if matlab tools are better or easier to use.

</pre><h2 id="2">Load VGG16</h2><p>Matlab's vgg16 add-on is the same VGG16 used by blog.keras, I checked every single weight, they matched. I also imported keras' network to matlab and got the same classification as vgg16. You may want to try prove me wrong, but I am convinced that Matlab's net is what everybody uses with Python.</p><pre class="codeinput">net=vgg16;
</pre><h2 id="3">Visualise increasingly complex layers</h2><p>
Here I follow the blog's outline, showing examples of the same layers, if not the same nodes.
 First I list which layers I want to visualise (convOnes in the code below). Then I set zoom-out steps. 
 For the first, simpler layers, I want to zoom-out a bit, otherwise I get a 3 by 3 pixel image per node. I do that
using 'PyramidLevels'. 7 pyramid levels are okay for a 3 by 3 node, but not to large sets of weights.
 My Ubuntu laptop+GPU crashed when trying such a stunt. So I set the steps between 7 to 3 according to filter size.
</p><pre class="codeinput">
convOnes=[2,7,12,19,26,30];
pyramid=[7,6,5,4,3,3];
figure(<span class="string">'units'</span>,<span class="string">'normalized'</span>,<span class="string">'outerposition'</span>,[0 0 1 1])
<span class="keyword">for</span> layeri=1:length(convOnes)
    clear <span class="string">convX_1</span>
    <span class="keyword">for</span> filteri=1:4
        I = deepDreamImage(net,convOnes(layeri),filteri,<span class="string">'verbose'</span>,false,<span class="string">'PyramidLevels'</span>,pyramid(layeri));
        convX_1(1:size(I,1),1:size(I,2),1:3,filteri)=deprocessImage(I);
    <span class="keyword">end</span>
    subplot(2,3,layeri)
    montage(convX_1);
    title(strrep(net.Layers(convOnes(layeri)).Name,<span class="string">'_'</span>,<span class="string">'-'</span>))
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="visiontools_importKeras2_01.png" alt=""> <h2 id="4">Visualize class nodes</h2><p>The blog shows not so birdy magpie and a not so snaky sea snake. Since matlab and python do not start from the same index I accidentally visualised Green Mamba and Jay. Let's look at all four</p><pre class="codeinput">nodes=[18,19,65,66];
figure(<span class="string">'units'</span>,<span class="string">'normalized'</span>,<span class="string">'outerposition'</span>,[0 0 1 1])
<span class="keyword">for</span> nodei=1:4;
    I = deepDreamImage(net,39,19,<span class="string">'PyramidLevels'</span>,3,<span class="string">'PyramidScale'</span>,2);
    I = deprocessImage(I);
    subplot(2,2,nodei)
    imshow(I)
    title(net.Layers(41).ClassNames{nodes(nodei)})
<span class="keyword">end</span>
</pre><pre class="codeoutput">

|============================================|
|    Pyramid   |  Iteration   |  Activation  |
|     Level    |              |   Strength   |
|============================================|
|            1 |            1 |         0.13 |
|            1 |            2 |         1.52 |
															
			...

|            3 |            9 |        58.08 |
|            3 |           10 |        54.07 |
|============================================|

</pre><img vspace="5" hspace="5" src="visiontools_importKeras2_02.png" alt="">
 <h2 id="5">So what have we learned?</h2>
 <p>I do not work for Matlab, but their visualizetion tool is cool and helpful. 
 Matlab is not the best option now for deep-learning for a few reasons, 
 perhaps mainly because it is not free and the options are still limited. 
However if you want to use the most popular pretrained nets, 
or the most common net types (such as Faster R-CNN) then Matlab has its 
advantages - fewer lines of code and easy visualisation. 
As for how AI sees the world - I think it sees birds and snakes pretty well as we do, 
with the main difference that for CNN it doesn't matter so much how the beak connects to the feathers 
(although <a href="https://raghakot.github.io/keras-vis/"> this</a> toolkit yields well connected bird pieces). 
However, when nodes have to be sensitive for different kinds of birds and different categories altogether, 
you should expect distinguishing features to show up, and not necessarily an image of the class architype.</p>
 <img src="https://raw.githubusercontent.com/raghakot/keras-vis/master/images/dense_vis/cover.png?raw=true" alt="Bird from keras-vis">
 <br>keras-vis toolkit example
 <br>
 <br>
 <br> other links:
  <br> <a href="https://github.com/philipperemy/keras-visualize-activations"> keras-visualize-activations</a>  - a tool to visualize filters activation 
 <br> <a href=" https://jacobgil.github.io/deeplearning/filter-visualizations"> filter-visualization</a> - an enlightening explanation about the matter
 
<pre class="codeinput">disp(<span class="string">'bye bye'</span>)
</pre><pre class="codeoutput">bye bye
</pre><p class="footer"><br>haha<br></p></div>
